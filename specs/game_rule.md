# アプリケーション仕様書：バトルライン（デジタル・テーブルトップ版）

## 1. プロジェクト概要
本ドキュメントは、ライナー・クニツィア作のボードゲーム『バトルライン』を、オンライン対戦（ボイスチャット併用）可能なデジタル・テーブルトップアプリとして開発するための仕様書である。

本アプリはルール判定エンジンを持たず、現実のテーブル上でカードやコマを動かすのと同様の「自由な操作性」と「コンポーネントの管理」を提供することを主目的とする。

## 2. 画面構成とエリア定義（UIスペック）
プレイヤーが操作を行うためのフィールド定義です。システムによる制限は設けず、ドラッグ＆ドロップで任意の場所にカードを配置できる設計とします。

### センターエリア（戦線）
* **フラッグオブジェクト (9個)** : 画面中央に横一列に配置。
* **制御マーカー機能** : 各フラッグに対し、「Player1確保済」「Player2確保済」を示すマーカー（ポーンコマ等）を配置・移動できる機能。タップで色が切り替わる、またはコマを置く形式とする。

### プレイエリア（カード配置ゾーン）
* **スロット** : 各フラッグの手前（自分側・相手側）に、通常は3枚分のカード配置スペースを確保。
* **拡張スロット（泥沼対応）** : カードが重なっても視認できるよう、縦にずらして配置可能なスペース、または4枚目以降も配置可能な余白を設けること。
* **戦術カード配置ゾーン** : フラッグに対する「地形効果」や、使い捨ての「謀略効果」カードを置くためのフリースペース。

### ハンドエリア（手札）
* 自分にしか見えない領域。
* 所持上限である7枚以上（「偵察」使用時の一時的な10枚など）を持てるスクロール機能または縮小表示機能を実装すること。

### デッキエリア
* **部隊カード山札** : クリック/タップで1枚ドローする機能。
* **戦術カード山札** : クリック/タップで1枚ドローする機能。
* **捨て札置き場** : 任意のカードをドラッグして捨てることができる領域。

## 3. 内容物（アセットリスト）
アプリ内に実装が必要なオブジェクト一覧です。

### 3.1 部隊カード (Troop Cards)
* **総数** : 60枚
* **構成** : 6色 × 各色10枚（数値 1 ～ 10）
* **色の種類** : 赤、青、緑、黄、紫、橙
* **デザイン要件** : 色覚多様性に配慮し、色だけでなく「形状アイコン」または「兵種イラスト」でも区別がつくようにすること。

### 3.2 戦術カード (Tactics Cards)
* **総数** : 10枚（全てユニーク）
* **カード名称と内訳** :
    * アレキサンダー (Alexander)
    * ダリウス (Darius)
    * 援軍騎兵 (Companion Cavalry)
    * 盾 (Shield Bearers)
    * 霧 (Fog)
    * 泥沼 (Mud)
    * 偵察 (Scout)
    * 配置転換 (Redeploy)
    * 脱走 (Deserter)
    * 裏切り (Traitor)

### 3.3 その他コンポーネント
* **フラッグ** : 9個（赤いポーン状のコマ、または旗アイコン）
* **確保マーカー** : どちらが確保したかを示す目印（例：フラッグ自体が所有者の色に点灯する、または所有者側に移動するギミック）。

## 4. ゲームルール・マニュアル（プレイヤー参照用）
※本項目のロジックを自動化する必要はありませんが、**「プレイヤーがこの操作を行える」**ようにUIを実装する必要があります。

### 4.1 ゲームの準備（Setup）
1.  9つのフラッグを一直線に並べる。
2.  部隊カード（60枚）をシャッフルし、各プレイヤーに7枚ずつ配る。残りは山札とする。
3.  戦術カード（10枚）をシャッフルし、部隊山札とは別の山札とする。
4.  先攻・後攻を決定する。

### 4.2 勝利条件（Victory Conditions）
以下のいずれかを満たしたプレイヤーが勝利を宣言し、ゲーム終了となる。
* **3地点突破** : 隣り合う（連続する）3つのフラッグを確保する。
* **5地点制圧** : 場所を問わず、合計5つのフラッグを確保する。

### 4.3 プレイ手順（Game Flow）
手番プレイヤーは以下の手順を行う。
1.  **カードのプレイ** : 手札から1枚選び、任意のフラッグの自分側スロットに配置する（または戦術カードを使用する）。
2.  **フラッグの確保判定** : （※後述の4.7参照）勝利条件を満たしているフラッグがあれば確保を宣言する。
3.  **手札の補充** : 部隊山札、または戦術山札のどちらか好きな方から1枚引き、手札に加える。
    * **システム要件** : どちらの山札からもドロー可能なUIであること。

### 4.4 部隊カードの説明
* 色と数字を持つ基本カード。
* 各フラッグに対し、原則として **3枚** まで配置できる。

### 4.5 フォーメーション（役）について
フラッグごとの勝敗は、配置された3枚のカードの組み合わせ（フォーメーション）の強さで決まる。強い順に以下の通り。

| 順位 | 役名 | 構成 | ポーカーでの例 |
| :--- | :--- | :--- | :--- |
| 1 | ウェッジ (Wedge) | 同色 かつ 数字が連番 | ストレートフラッシュ |
| 2 | ファランクス (Phalanx) | 数字がすべて同じ | スリーカード |
| 3 | バタリオン (Battalion) | 色がすべて同じ | フラッシュ |
| 4 | スカーミッシャー (Skirmish Line) | 数字が連番 (色は不問) | ストレート |
| 5 | ホスト (Host) | 上記以外 | ブタ (ハイカード) |

**強弱判定の補足 :**
* 同じ役同士の場合、 **数字の合計値** が大きい方が勝つ。
* 役も合計値も同じ場合、 **先にその役を完成させた方** が勝つ。

### 4.6 フラッグ確保の仕方（Claiming）
プレイヤーは自分の手番で、あるフラッグにおいて「自分が勝利している」ことが確定した場合、そのフラッグを確保（自分のものに）できる。

* **確保のタイミング** : 手番の開始時（上級ルール）またはカード配置直後（標準ルール）。プレイヤー間で合意して決める。
* **証明（Proof）** :
    * 相手のカードが3枚揃っていなくても、場に出ているカード（公開情報）から論理的に相手が勝てないことを証明できれば、その時点で確保できる。
    * **システム要件** : 未完成の状態でもフラッグマーカーを移動・確保状態にできる操作が必要。

### 4.7 戦術カードについて（種類と効果）
戦術カードは強力だが、「相手がプレイした枚数 +1枚」までしかプレイできない制限がある（プレイヤー同士で確認する）。

#### 【士気高揚戦術】（部隊カードとして配置する）
* **アレキサンダー / ダリウス (Leader)**:
    * ワイルドカード。あらゆる色・数字として扱える。
    * 制限 : 1回のゲームで1人どちらか1枚しか使えない。
* **援軍騎兵 (Companion Cavalry)**:
    * 「数字の8」として扱う。色はワイルド（任意）。
* **盾 (Shield Bearers)**:
    * 「数字の1, 2, 3」のいずれかとして扱う。色はワイルド（任意）。

#### 【地形戦術】（フラッグ自体に作用する）
* **霧 (Fog)**:
    * そのフラッグでは役が無効になり、単純な数字の合計値のみで勝負する。
    * **システム要件** : スロットではなくフラッグの横などに置けるスペースが必要。
* **泥沼 (Mud)**:
    * そのフラッグの完成に必要な枚数が **4枚** になる。
    * **システム要件** : このカードが置かれた列だけ、カードを4枚置けるようにUIが許容する必要がある。

#### 【謀略戦術】（使い捨て効果）
これらは使用後、効果を適用して捨て札にする。

* **偵察 (Scout)**:
    * 山札（部隊・戦術の組み合わせ自由）から合計3枚引く。その後、手札から不要な2枚を山札の上に（好きな順で）戻す。
    * **システム要件**: 一時的に手札上限を超えるドロー操作と、カードを山札に戻す操作が必要。
* **配置転換 (Redeploy)**:
    * 自分の配置済みのカード（未確保フラッグにあるもの）を1枚選び、別の場所に移動するか、捨て札にする。
    * **システム要件**: 一度盤面に出したカードを再度ドラッグして移動または捨て札にできる機能。
* **脱走 (Deserter)**:
    * 相手の配置済みのカード（未確保フラッグにあるもの）を1枚選び、捨て札にする。
    * **システム要件**: 相手フィールドのカードを操作（削除/移動）できる権限、または相手に操作を依頼する機能。
* **裏切り (Traitor)**:
    * 相手の配置済みの部隊カード（未確保フラッグにあるもの）を1枚選び、自分の空きスロットに移動する。
    * **システム要件**: 相手フィールドから自分フィールドへのカード移動（ドラッグ＆ドロップ）。

### 4.8 ゲームの終了条件
* いずれかのプレイヤーが勝利条件（フラッグ3連続または合計5個）を満たした時点で終了。
* **山札が尽きた場合**：カードは補充せず、手札のみでプレイを続行する。
* **手札も出せなくなった場合**、パスをする。両者パスとなったらゲーム終了し、現在の盤面で判定を行う。

## 5. アプリ機能要件（サンドボックス機能）
上記のルールをプレイヤーが手動で実行するために必要な機能リストです。

### 5.1 カード操作
* **自由配置** : プレイヤーは手札のカードを盤面の任意の位置（自分側・相手側問わず、または相手側への干渉は確認ダイアログ付きで）に配置できること。
* **スタック** : 泥沼（4枚目）や、配置スペース不足時にカードを重ねて置けるようにすること（下のカードの数字・色が見えるようにずらして表示）。
* **詳細表示** : 盤面のカードを長押し/拡大操作することで、テキストや詳細を確認できること。

### 5.2 デッキ・手札操作
* **複数ドロー** : 「偵察」カードのために、1ターンに複数枚ドローできること。
* **デッキへの返却** : 手札のカードをドラッグして、山札の上に戻せること。
* **山札選択** : 部隊デッキ、戦術デッキのどちらかを選んで引けること。

### 5.3 盤面管理
* **フラッグ状態切替** : フラッグをタップすることで、「中立」「P1確保」「P2確保」の状態（色など）をトグル切り替えできること。
* **捨て札確認** : 捨て札置き場のカード一覧を確認できること（「証明」の際に、既に除外されたカードを確認する必要があるため重要）。

### 5.4 通信・同期
* **リアルタイム同期** : カードの移動、配置、フラッグの状態変更が即座に相手画面に反映されること。
* **カーソル表示（推奨）** : 相手がどこを指しているか、どのカードを触ろうとしているかがわかると、ボイスチャットでの「これ」「それ」の指示がスムーズになる。
