# 仕様変更: ドローフローの厳格化とターン終了シーケンスの導入

## 概要
プレイヤーが任意のタイミングで山札からドローできる現状の仕様を廃止し、ターン終了時の一連の流れ（シーケンス）としてドローを行うように変更する。
これにより、プレイ順序（カード配置 -> ドロー -> 終了）をシステム的に強制し、ルールの誤認や操作ミスを防ぐ。
メイン画面上の山札クリックは、戦術カード「偵察（Scout）」の効果処理中のみ許可する。

## 変更点

### 1. UI: メイン画面 (`src/board/Board.tsx`)

#### A. 山札 (DeckPile) の挙動変更
*   **現状**: 自分のターンならいつでもクリック可能。
*   **変更後**:
    *   原則として**クリック無効**（`isDisabled = true`）。
    *   例外: **スカウトモード中**（`G.scoutDrawCount !== null` 等、偵察の効果でドローが必要な状態）のみクリック可能とする。

#### B. ターン終了ボタン (End Turn Button) の挙動変更
*   **現状**: `moves.endTurn()` を直接呼び出し、即座にターンを終了する。
*   **変更後**:
    *   `moves.endTurn()` を呼ばず、新規コンポーネント **`DrawSelectionModal`** を表示する状態にする。
    *   ボタンのラベルや活性状態は変更しない。

### 2. UI: 新規モーダル (`src/board/DrawSelectionModal.tsx`)

ターン終了時に表示されるドロー選択用モーダル。

*   **Props**:
    *   `isOpen`: boolean
    *   `onClose`: () => void （「戻る」ボタン用）
    *   `onSelect`: (type: 'troop' | 'tactic') => void （ドロー選択用）
    *   `troopCount`: number （部隊デッキ残数表示用）
    *   `tacticCount`: number （戦術デッキ残数表示用）
*   **表示内容**:
    *   タイトル: "ターン終了"
    *   メッセージ: "どちらの山札からカードを引きますか？"
    *   **アクションボタン**:
        *   **[部隊カード (Troop)]**: クリックで `onSelect('troop')` を実行。残数0なら無効。
        *   **[戦術カード (Tactic)]**: クリックで `onSelect('tactic')` を実行。残数0なら無効。
        *   **[戻る (Cancel)]**: クリックで `onClose()` を実行。
*   **スタイリング**:
    *   既存の `ConfirmModal` や `DiscardModal` と統一感のあるデザイン（黒背景、ボーダー、中央配置）。

### 3. ロジック (`src/moves.js` / `src/Game.js`)

#### A. 新規Move: `drawAndEndTurn`
ドローとターン終了をアトミック（不可分）な操作として実行するためのMoveを追加する。

*   **引数**: `deckType` ('troop' | 'tactic')
*   **処理**:
    1.  `drawCard` と同様のロジックでカードを1枚引く。
    2.  **重要**: その後、明示的に `ctx.events.endTurn()` を呼び出し、ターンを終了させる。
*   **目的**: クライアント側で `drawCard` -> `endTurn` と2回通信するラグやエラーを防ぐ。

#### B. 既存Move: `drawCard` の制限（オプション）
*   スカウト中以外の直接呼び出しを禁止するバリデーションを追加しても良いが、UI側で制御できていれば必須ではない。今回はUI制御を主とする。

## 実装ステップ

1.  **`src/moves.js`**: `drawAndEndTurn` 関数を実装し、`src/Game.js` に登録する。
2.  **`src/board/DrawSelectionModal.tsx`**: モーダルコンポーネントを新規作成する。
3.  **`src/board/Board.tsx`**:
    *   `DeckPile` の `isDisabled` 条件を厳格化（スカウト中のみ許可）。
    *   `End Turn` ボタンのハンドラを修正（モーダル表示）。
    *   モーダルからのコールバックで `moves.drawAndEndTurn` を呼び出す処理を追加。

## 確認事項
*   プレイ中、山札をクリックしても反応しないこと。
*   スカウト使用時は山札をクリックしてドローできること。
*   End Turnボタンを押すとモーダルが出ること。
*   「戻る」でプレイ画面に戻れること。
*   デッキを選ぶと、カードが引かれ、かつターンが相手に移ること。
