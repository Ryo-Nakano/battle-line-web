# ロビー機能とマッチング、および先攻後攻決めミニゲーム仕様書

## 概要
オンライン対戦を実現するためのロビー機能、IDによるマッチング、および対戦開始前の先攻後攻決めミニゲームを実装する。

## 要件

### 1. ロビー画面
-   **アクセス時**: サイトにアクセスした際、最初に表示される画面とする。
-   **UI要素**:
    -   ルームID入力フォーム（半角英数字）
    -   「対戦開始」ボタン
-   **挙動**:
    -   ユーザーが任意のIDを入力し、ボタンを押下する。
    -   同じIDを入力したユーザー同士がマッチングされる。
    -   **満員時の対応**: 入力されたIDの部屋が既に存在し、2人で満員だった場合はエラーメッセージを表示し、入室させない。

### 2. マッチングシステム
-   `boardgame.io` の仕組みを利用し、入力されたIDを `matchID` として使用する。
-   2人対戦専用とする。

### 3. 先攻後攻決めミニゲーム
-   **タイミング**: マッチング成立後、本戦開始前に実施する。
-   **ルール**:
    1.  画面上に裏向きのカードが3枚表示される。
    2.  両プレイヤーはそこから1枚を選択する。
    3.  選んだカードを表にし、数値（または強さ）を比較する。
    4.  数値が大きい方のプレイヤーが勝利。
        -   引き分けの場合は再抽選（またはランダム、仕様要確認だが一旦再抽選とする）。
    5.  勝者が「先攻」か「後攻」を選択する。
-   **本戦への移行**: 先攻後攻決定後、通常のバトルラインのセットアップを行い、ゲームを開始する。

## 実装計画概要

### フェーズ1: ロビーとマッチング
-   `App.tsx` を改修し、ロビー画面とゲーム画面の出し分けを行う。
-   `boardgame.io` の `LobbyClient` API または `SocketIO` の接続エラーハンドリングを用いて満員判定を行う。

### フェーズ2: ミニゲーム実装
-   `Game.js` の `setup` を修正し、初期状態ではミニゲーム用のステートを持つようにする。
-   新しいフェーズ `determination` (仮) を追加。
-   ミニゲーム用の `moves`（カード選択、先攻後攻選択）を追加。
-   ミニゲーム終了後、本戦のセットアップ（手札配布など）を行うロジックを追加。

## 技術的詳細
-   **サーバー**: `server.js` は既存の `boardgame.io/server` を使用。
-   **クライアント**: `boardgame.io/react` の `Client` コンポーネントを動的にマウント、または `Lobby` コンポーネントを作成して管理。
